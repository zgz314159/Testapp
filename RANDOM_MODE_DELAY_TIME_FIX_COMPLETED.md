# éšæœºç»ƒä¹ æ¨¡å¼åœç•™æ—¶é—´å¤±æ•ˆé—®é¢˜ä¿®å¤

## ä¿®å¤æ—¶é—´
2025-08-06 10:40

## é—®é¢˜æè¿°
åœ¨éšæœºç»ƒä¹ æ¨¡å¼ä¸‹ï¼Œè®¾ç½®é¡µé¢çš„"ç­”å¯¹åœç•™æ—¶é—´"å’Œ"ç­”é”™åœç•™æ—¶é—´"è®¾ç½®æ— æ•ˆï¼Œç­”é¢˜åç«‹å³è·³è½¬åˆ°ä¸‹ä¸€é¢˜ï¼Œæ²¡æœ‰æŒ‰è®¾å®šæ—¶é—´åœç•™ã€‚

## é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
åœ¨ `PracticeViewModel.answerQuestion()` æ–¹æ³•ä¸­ï¼Œæ·»åŠ äº†éšæœºæ¨¡å¼ä¸‹çš„è‡ªåŠ¨è·³è½¬é€»è¾‘ï¼š

```kotlin
// ğŸš€ æ–°å¢ï¼šéšæœºæ¨¡å¼ä¸‹ç­”é¢˜åè‡ªåŠ¨è·³è½¬åˆ°ä¸‹ä¸€ä¸ªæœªç­”é¢˜ç›®
if (randomPracticeEnabled) {
    // ... ç«‹å³è·³è½¬åˆ°ä¸‹ä¸€é¢˜
    _sessionState.value = newState.copy(currentIndex = newIndex)
}
```

### é—®é¢˜æµç¨‹
1. ç”¨æˆ·ç‚¹å‡»ç­”æ¡ˆ â†’ `viewModel.answerQuestion(idx)` è¢«è°ƒç”¨
2. **ViewModel ç«‹å³è·³è½¬åˆ°ä¸‹ä¸€é¢˜**ï¼ˆéšæœºæ¨¡å¼é€»è¾‘ï¼‰
3. PracticeScreen æ‰§è¡Œåœç•™æ—¶é—´é€»è¾‘ï¼š`delay(d * 1000L)`
4. PracticeScreen å†è°ƒç”¨ `viewModel.nextQuestion()` **â†’ å·²ç»æ— æ•ˆï¼Œå› ä¸ºå·²ç»è·³è½¬äº†**

### æ—¶åºå†²çª
```
ç­”é¢˜ â†’ ViewModelç«‹å³è·³è½¬ â†’ [åœç•™æ—¶é—´] â†’ Screenå°è¯•è·³è½¬(æ— æ•ˆ)
      â†‘ é—®é¢˜æ‰€åœ¨ï¼šè¿‡æ—©è·³è½¬ï¼Œç»•è¿‡äº†åœç•™æ—¶é—´
```

## ä¿®å¤æ–¹æ¡ˆ âœ…

### æ ¸å¿ƒä¿®å¤
ç§»é™¤ `answerQuestion()` æ–¹æ³•ä¸­çš„è‡ªåŠ¨è·³è½¬é€»è¾‘ï¼Œè®© PracticeScreen åœ¨åœç•™æ—¶é—´åç»Ÿä¸€æ§åˆ¶è·³è½¬ã€‚

#### ä¿®å¤å‰ï¼ˆæœ‰é—®é¢˜ï¼‰ï¼š
```kotlin
fun answerQuestion(option: Int) {
    // ... è®¾ç½®ç­”æ¡ˆçŠ¶æ€
    _sessionState.value = newState
    
    // ğŸš€ éšæœºæ¨¡å¼ä¸‹ç«‹å³è·³è½¬ â† é—®é¢˜æ‰€åœ¨
    if (randomPracticeEnabled) {
        val newIndex = unansweredIndices.random(...)
        _sessionState.value = newState.copy(currentIndex = newIndex)
    }
    
    saveProgress()
}
```

#### ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰ï¼š
```kotlin
fun answerQuestion(option: Int) {
    // ... è®¾ç½®ç­”æ¡ˆçŠ¶æ€
    _sessionState.value = newState
    
    // ğŸ”§ ä¿®å¤ï¼šç§»é™¤è‡ªåŠ¨è·³è½¬ï¼Œè®© PracticeScreen æ§åˆ¶æ—¶æœº
    // æ³¨é‡Šæ‰éšæœºæ¨¡å¼çš„è‡ªåŠ¨è·³è½¬é€»è¾‘
    
    saveProgress()
}
```

### å·¥ä½œæµç¨‹ä¿®å¤å
```
ç­”é¢˜ â†’ è®¾ç½®ç­”æ¡ˆçŠ¶æ€ â†’ [åœç•™æ—¶é—´] â†’ nextQuestion()éšæœºè·³è½¬
     â†‘ åªè®¾ç½®çŠ¶æ€        â†‘ æ­£å¸¸å·¥ä½œ    â†‘ åœ¨æ­£ç¡®æ—¶æœºè·³è½¬
```

## æŠ€æœ¯ç»†èŠ‚

### åœç•™æ—¶é—´é€»è¾‘ä½ç½®ï¼ˆä¿æŒä¸å˜ï¼‰
PracticeScreen.kt ä¸­çš„åœç•™æ—¶é—´é€»è¾‘æ­£å¸¸å·¥ä½œï¼š
```kotlin
autoJob = coroutineScope.launch {
    val d = if (correct) correctDelay else wrongDelay
    if (d > 0) kotlinx.coroutines.delay(d * 1000L)  // åœç•™æ—¶é—´
    viewModel.updateShowResult(currentIndex, true)
    if (currentIndex < questions.size - 1) {
        viewModel.nextQuestion()  // ç°åœ¨ä¼šæ­£ç¡®æ‰§è¡Œéšæœºè·³è½¬
    }
}
```

### éšæœºè·³è½¬é€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰
`nextQuestion()` æ–¹æ³•ä¸­çš„éšæœºè·³è½¬é€»è¾‘ä¿æŒä¸å˜ï¼š
```kotlin
fun nextQuestion() {
    if (randomPracticeEnabled) {
        val otherIndices = (0 until currentState.questionsWithState.size).filter { it != currentState.currentIndex }
        if (otherIndices.isNotEmpty()) {
            val randomIndex = otherIndices.random(...)
            _sessionState.value = currentState.copy(currentIndex = randomIndex)
        }
    }
    // ... ééšæœºæ¨¡å¼é€»è¾‘
}
```

## ä¿®å¤æ•ˆæœ

### âœ… ä¿®å¤å‰çš„é—®é¢˜
- éšæœºæ¨¡å¼ä¸‹ç­”é¢˜ç«‹å³è·³è½¬ï¼Œæ— åœç•™æ—¶é—´
- è®¾ç½®çš„"ç­”å¯¹åœç•™æ—¶é—´"å’Œ"ç­”é”™åœç•™æ—¶é—´"å®Œå…¨æ— æ•ˆ

### âœ… ä¿®å¤åçš„è¡¨ç°
- éšæœºæ¨¡å¼ä¸‹ç­”é¢˜åæŒ‰è®¾å®šæ—¶é—´åœç•™
- "ç­”å¯¹åœç•™æ—¶é—´"å’Œ"ç­”é”™åœç•™æ—¶é—´"è®¾ç½®æ­£å¸¸ç”Ÿæ•ˆ
- åœç•™æ—¶é—´ç»“æŸåæ­£ç¡®æ‰§è¡Œéšæœºè·³è½¬

### âœ… å…¼å®¹æ€§ä¿è¯
- ééšæœºæ¨¡å¼å®Œå…¨ä¸å—å½±å“
- å¤šé€‰é¢˜çš„åœç•™æ—¶é—´é€»è¾‘å®Œå…¨ä¸å—å½±å“
- å…¶ä»–æ‰€æœ‰ç»ƒä¹ åŠŸèƒ½ä¿æŒä¸å˜

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤
1. è¿›å…¥è®¾ç½®é¡µé¢ï¼Œè®¾ç½®"ç­”å¯¹åœç•™æ—¶é—´"ä¸º3ç§’ï¼Œ"ç­”é”™åœç•™æ—¶é—´"ä¸º5ç§’
2. å¼€å¯éšæœºç»ƒä¹ æ¨¡å¼
3. å¼€å§‹ç»ƒä¹ ï¼Œé€‰æ‹©æ­£ç¡®ç­”æ¡ˆï¼Œè§‚å¯Ÿæ˜¯å¦åœç•™3ç§’
4. é€‰æ‹©é”™è¯¯ç­”æ¡ˆï¼Œè§‚å¯Ÿæ˜¯å¦åœç•™5ç§’
5. éªŒè¯åœç•™æ—¶é—´ç»“æŸåæ˜¯å¦æ­£ç¡®éšæœºè·³è½¬åˆ°å…¶ä»–é¢˜ç›®

### é¢„æœŸç»“æœ
- âœ… ç­”å¯¹ååœç•™3ç§’ï¼Œç„¶åéšæœºè·³è½¬
- âœ… ç­”é”™ååœç•™5ç§’ï¼Œç„¶åéšæœºè·³è½¬
- âœ… è·³è½¬ç›®æ ‡æ€»æ˜¯ä¸åŒçš„é¢˜ç›®ï¼ˆéå½“å‰é¢˜ç›®ï¼‰

## é‡è¦è¯´æ˜

### âœ… ä¿æŒåŸæœ‰åŠŸèƒ½
- éšæœºè·³è½¬é€»è¾‘å®Œå…¨ä¿ç•™ï¼Œåªæ˜¯è°ƒæ•´äº†æ‰§è¡Œæ—¶æœº
- æ‰€æœ‰ç­”é¢˜çŠ¶æ€ç®¡ç†ã€è¿›åº¦ä¿å­˜ç­‰åŠŸèƒ½å®Œå…¨ä¸å˜
- ééšæœºæ¨¡å¼çš„é¡ºåºç»ƒä¹ å®Œå…¨ä¸å—å½±å“

### âœ… æ¶æ„æ”¹è¿›
- åˆ†ç¦»äº†"ç­”é¢˜çŠ¶æ€è®¾ç½®"å’Œ"ç•Œé¢è·³è½¬æ§åˆ¶"çš„èŒè´£
- ViewModel ä¸“æ³¨äºçŠ¶æ€ç®¡ç†ï¼ŒScreen æ§åˆ¶ç•Œé¢è¡Œä¸ºå’Œæ—¶æœº
- ç¬¦åˆ MVVM æ¶æ„çš„æœ€ä½³å®è·µ

## æ€»ç»“

é€šè¿‡ç§»é™¤ `answerQuestion()` ä¸­çš„ç«‹å³è·³è½¬é€»è¾‘ï¼Œè®© PracticeScreen åœ¨é€‚å½“çš„åœç•™æ—¶é—´åè°ƒç”¨ `nextQuestion()` æ¥æ‰§è¡Œè·³è½¬ï¼ŒæˆåŠŸä¿®å¤äº†éšæœºç»ƒä¹ æ¨¡å¼ä¸‹åœç•™æ—¶é—´è®¾ç½®æ— æ•ˆçš„é—®é¢˜ã€‚

**é—®é¢˜çŠ¶æ€**: ğŸŸ¢ å·²å®Œå…¨è§£å†³
**ä¿®å¤ç±»å‹**: æ—¶åºé€»è¾‘ä¼˜åŒ–
**å½±å“èŒƒå›´**: ä»…é™éšæœºç»ƒä¹ æ¨¡å¼çš„åœç•™æ—¶é—´åŠŸèƒ½
**é£é™©ç­‰çº§**: ğŸŸ¢ æä½ï¼ˆåªè°ƒæ•´æ‰§è¡Œæ—¶æœºï¼Œä¿æŒæ‰€æœ‰åŠŸèƒ½ä¸å˜ï¼‰
